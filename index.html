<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Falafel</title>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <!-- Ruffle JS (manual initialization) -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <style>
    html,body{height:100%}
    .game-area{min-height:420px}
    .is-clickable{cursor:pointer}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">
        <strong>Falafel<i>ᵝ</i></strong>
      </a>
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="navMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="#gallery">Игры</a>
        <a class="navbar-item" href="#about">О сайте</a>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <section class="section">
    <div class="container">
      <div class="columns">
        <div class="column is-one-third">
          <h1 class="title">Игровая панель</h1>
          <p class="subtitle">Выберите игру в галерее - она загрузится в плеер ниже.</p>

          <div id="gallery" class="box" style="max-height:55vh; overflow:auto">
            <!-- cards rendered by JS -->
            <div id="gamesGrid" class="columns is-multiline"></div>
          </div>

          <div class="box">
            <h2 class="subtitle is-6">Загрузить .swf</h2>
            <p class="is-size-7">Для локальной загрузки (разработчикам): используйте папку <code>/games</code> в репозитории. На GitHub Pages просто закоммитьте файлы туда.</p>
          </div>

        </div>

        <div class="column">
          <h2 class="title is-4">Плеер</h2>
          <div class="box game-area">
            <!-- Manual Ruffle container -->
            <div id="container" style="width:620px; height:520px;"></div>
              <p class="has-text-grey">Выберите игру из галереи, чтобы начать.</p>
            </div>
          </div>

          <div class="box">
            <p class="is-size-7">Ruffle работает на большинстве современных браузеров, но некоторые игры, использующие специфичные плагины или расширенные функции Flash, могут неправильно работать.</p>
          </div>
        </div>
      </div>

      <hr />
      <section id="about">
        <h3 class="title is-5">О сайте</h3>
        <p>Это сайт с играми Flash и эмулятором Ruffle для его работы.</p>
      </section>

    </div>
  </section>

  <footer class="footer">
    <div class="content has-text-centered">
      <p>Made by <a href="https://github.com/IgorSlot">@igorslot</a></p>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    // Navbar burger toggle
    document.addEventListener('DOMContentLoaded', () => {
      const burger = document.querySelector('.navbar-burger');
      const menu = document.getElementById('navMenu');
      burger && burger.addEventListener('click', () => {
        burger.classList.toggle('is-active');
        menu.classList.toggle('is-active');
      });
    });

    // --- Configure your games here ---
    // Put the corresponding .swf files into a `games/` folder in the repo.
    const gamesList = [
      { title: 'Bloons TD4', file: 'games/bloonstd4.swf', thumb: '' },
      { title: 'Fireboy and Watergirl 3: In The Ice Temple', file: 'games/FireBoyAndWaterGirl.swf', thumb: '' },
      { title: 'Happy Wheels', file: 'games/hw_preloader_bf.swf', thumb: '' }
    ];

    const gamesGrid = document.getElementById('gamesGrid');
    const playerWrap = document.getElementById('playerWrap');

    function createGameCard(game){
      const col = document.createElement('div');
      col.className = 'column is-half';

      const card = document.createElement('div');
      card.className = 'card is-clickable';
      card.onclick = () => loadGame(game);

      const cardContent = `
        <div class="card-content">
          <p class="title is-6">${escapeHtml(game.title)}</p>
          <p class="subtitle is-7">${escapeHtml(game.file)}</p>
        </div>
      `;

      card.innerHTML = cardContent;
      col.appendChild(card);
      return col;
    }

    function renderGallery(){
      gamesGrid.innerHTML = '';
      if(gamesList.length === 0){
        gamesGrid.innerHTML = '<div class="column">Нет игр. Добавьте SWF в папку <code>/games</code> и обновите массив <code>gamesList</code>.</div>';
        return;
      }
      gamesList.forEach(g => gamesGrid.appendChild(createGameCard(g)));
    }

    // Load game using manual Ruffle API
    function loadGame(game){
      const container = document.getElementById('container');
      container.innerHTML = '';

      const ruffle = window.RufflePlayer?.newest();
      const player = ruffle.createPlayer();
      container.appendChild(player);
      player.ruffle().load(game.file);
    }

    // Minimal HTML-escape
    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\\':'\\\\','"':'&quot;'}[c]));
    }

    // Initialize
    renderGallery();

    // Optional: detect if Ruffle loaded
    window.addEventListener('ruffleloaded', ()=>console.log('Ruffle loaded'));
  </script>
