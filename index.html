<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Falafel</title>
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <!-- Ruffle JS (manual initialization) -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <style>
    html, body {
      -ms-overflow-style: none;  /* IE и Edge */
      scrollbar-width: none;  /* Firefox */
      height:100;
      background-color: #F0F0F0;
    }

    .game-area {
      min-height:420px
    }

    .is-clickable {
      cursor:pointer
    }

    ::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar" role="navigation" aria-label="main navigation" style="background-color: #F0F0F0;">
    <div class="navbar-brand">
      <a class="navbar-item title" href="https://igorslot.github.io/falafel">
        <strong>Falafel</strong>ᵝ
      </a>
    </div>
  </nav>

  <!-- MAIN -->
  <section class="section">
    <div class="container">
      <div class="columns">
        <div class="column is-one-third">
          <h1 class="title">Игровая панель</h1>
          <p class="subtitle">Выберите игру в галерее - она загрузится в плеер ниже.</p>

          <div id="gallery" class="box" style="max-height: 410px; overflow:auto">
            <!-- cards rendered by JS -->
            <div id="gamesGrid" class="columns is-multiline"></div>
          </div>

        </div>

        <div class="column">
          <h2 class="title is-4">Плеер</h2>
          <div class="box game-area">
            <!-- Manual Ruffle container -->
            <div id="container" style="width:560px; height:410px;"></div>
              <p class="has-text-grey">Выберите игру из галереи, чтобы начать.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </section>

  <div class="content has-text-centered">
    <p>Made by <a href="https://github.com/IgorSlot">@igorslot</a></p>
  </div>

  <!-- SCRIPTS -->
  <script>
    // --- Configure your games here ---
    // Put the corresponding .swf files into a `games/` folder in the repo.
    const gamesList = [
      { title: 'Bloons TD 4', file: 'games/bloonstd4.swf', thumb: 'https://www.iphones.ru/wp-content/uploads/2011/01/Bloons-TD-4-iPhones.ru-Review.jpg' },
      { title: 'Fireboy and Watergirl 3: In The Ice Temple', file: 'games/FireBoyAndWaterGirl.swf', thumb: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcStQIe56nsFX2FGLPqvojbOo8onWZCxoDbpzQ&s' },
      { title: 'Shop Empire 3', file: 'games/Shop-Empire-3-kong.swf', thumb: 'https://infinity.unstable.life/images/Logos/2c/7b/2c7b58dd-fa69-8912-e023-17f3f29de39a.png?type=jpg' },
      { title: 'Happy Wheels Demo', file: 'games/547504_hw_demo.swf', thumb: 'https://infinity.unstable.life/images/Logos/65/c5/65c59812-7eae-4e9e-a3b5-350e5e865d51.png?type=jpg' },
      { title: 'Papa Louie 2: When Burgers Attack!', file: 'games/PapaLouie2_v2_1.swf', thumb: 'https://infinity.unstable.life/images/Logos/16/c2/16c27895-f7a6-6c65-18f3-feebcf87d28a.png?type=jpg' },
      { title: 'Papa Louie 3: When Sundaes Attack!', file: 'games/654944_papalouie3.swf', thumb: 'https://infinity.unstable.life/images/Logos/ab/63/ab638461-9317-bbaa-9ccf-e7f0360e3b1b.png?type=jpg' },
      { title: 'Bejeweled 2', file: 'games/bejeweled2.swf', thumb: 'https://infinity.unstable.life/images/Logos/60/0f/600f0be7-464f-0f74-6eea-157b36e65e94.png?type=jpg' },
      { title: "Papa's Bakeria", file: 'games/papasbakeria_101.swf', thumb: 'https://infinity.unstable.life/images/Logos/a8/70/a8707c0f-6aac-4c94-9d8a-cc397c97cc88.png?type=jpg' },
      { title: "Papa's Cheeseria", file: 'games/papascheeseria_102.swf', thumb: 'https://infinity.unstable.life/images/Logos/61/7c/617ca7f3-1cff-3f0c-5b53-07498b3b28d8.png?type=jpg' },
      { title: 'Earn to Die 2: Exodus', file: 'games/earntodie2-exodus.swf', thumb: 'https://infinity.unstable.life/images/Logos/b7/55/b755c33a-47b8-5cce-b45e-df744deaad6a.png?type=jpg' },
      { title: 'Super Mario 63', file: 'games/game-1257163257.swf', thumb: 'https://infinity.unstable.life/images/Logos/16/b0/16b04977-f714-4239-b343-b759e16a33af.png?type=jpg' }
    ];

    const gamesGrid = document.getElementById('gamesGrid');
    const playerWrap = document.getElementById('playerWrap');

    function createGameCard(game){
      const col = document.createElement('div');
      col.className = 'column is-half';

      const card = document.createElement('div');
      card.className = 'card is-clickable';
      card.onclick = () => loadGame(game);

      const cardContent = `
        <div class="card-image">
          <figure class="image is-128x64">
            <img src="${escapeHtml(game.thumb)}" />
          </figure>
        </div>
        <div class="card-content">
          <p class="title is-6">${escapeHtml(game.title)}</p>
        </div>
      `;

      card.innerHTML = cardContent;
      col.appendChild(card);
      return col;
    }

    function renderGallery(){
      gamesGrid.innerHTML = '';
      if(gamesList.length === 0){
        gamesGrid.innerHTML = '<div class="column">Нет игр.</div>';
        return;
      }
      gamesList.forEach(g => gamesGrid.appendChild(createGameCard(g)));
    }

    // Load game using manual Ruffle API
    function loadGame(game){
      const container = document.getElementById('container');
      container.innerHTML = '';

      const ruffle = window.RufflePlayer?.newest();
      const player = ruffle.createPlayer();
      container.appendChild(player);
      player.ruffle().load(game.file);
    }

    // Minimal HTML-escape
    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\\':'\\\\','"':'&quot;'}[c]));
    }

    // Initialize
    renderGallery();

    // Optional: detect if Ruffle loaded
    window.addEventListener('ruffleloaded', ()=>console.log('Ruffle loaded'));
  </script>
</body>
</html>
